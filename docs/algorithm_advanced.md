# ISAC-CRAN系统通信算法深化设计文档

## 1. 概述

本文档详细描述ISAC-CRAN系统中通信算法的深化设计，包括深度学习波束成形、3GPP信道建模和ESPRIT DOA估计算法。

## 2. 深度学习波束成形

### 2.1 算法原理

传统波束成形算法（如MVDR、MMSE）依赖于精确的信道状态信息(CSI)，但在实际场景中CSI估计存在误差。深度学习方法通过学习大量信道样本，能够：

1. **鲁棒性增强**：对CSI估计误差具有更强的容忍度
2. **非线性优化**：突破传统凸优化的限制
3. **实时推理**：训练完成后推理速度快

### 2.2 网络架构

```
输入层: 信道矩阵 H (Nt x Nr x K)
    ↓
卷积层1: 64 filters, 3x3 kernel, ReLU
    ↓
批归一化层
    ↓
卷积层2: 128 filters, 3x3 kernel, ReLU
    ↓
残差块 x 3
    ↓
全连接层: 512 units, ReLU
    ↓
输出层: 波束成形权重 W (Nt x Ns)
```

### 2.3 损失函数

采用加权和速率最大化目标：

```
L = -Σ log2(1 + SINR_k) + λ||W||²_F
```

其中：
- SINR_k：第k个用户的信干噪比
- λ：正则化系数
- ||W||²_F：Frobenius范数（功率约束）

### 2.4 训练策略

1. **数据生成**：使用3GPP TR 38.901信道模型生成训练数据
2. **迁移学习**：先在Rayleigh衰落信道预训练，再迁移到3GPP信道
3. **数据增强**：添加随机噪声、相位偏移增强泛化能力

## 3. 3GPP TR 38.901信道建模

### 3.1 信道模型概述

3GPP TR 38.901定义了5G NR系统的信道模型，支持0.5-100GHz频段，涵盖多种场景：

| 场景 | 描述 | 典型应用 |
|------|------|----------|
| RMa | 农村宏蜂窝 | 广覆盖、低密度 |
| UMa | 城市宏蜂窝 | 城市室外覆盖 |
| UMi-Street Canyon | 城市微蜂窝街道峡谷 | 密集城区 |
| Indoor-Office | 室内办公环境 | 企业办公 |
| Indoor-Factory | 室内工厂环境 | 工业物联网 |

### 3.2 大尺度参数

#### 3.2.1 路径损耗模型

**UMa场景（视距LOS）**:
```
PL = 28.0 + 22.0*log10(d3D) + 20.0*log10(fc) [dB]
```

**UMa场景（非视距NLOS）**:
```
PL = max(PL_LOS, 13.54 + 39.08*log10(d3D) + 20.0*log10(fc) - 0.6*(hUT-1.5)) [dB]
```

其中：
- d3D：三维距离（米）
- fc：载波频率（GHz）
- hUT：用户终端高度（米）

#### 3.2.2 阴影衰落

对数正态分布：
```
SF ~ N(0, σSF²)
```

标准差σSF取决于场景和LOS/NLOS条件。

### 3.3 小尺度参数

#### 3.3.1 时延扩展

```
DS = 10^(μDS + σDS*X) [log10(s)]
```

#### 3.3.2 角度扩展

- ASD (Azimuth Spread of Departure): 发射方位角扩展
- ASA (Azimuth Spread of Arrival): 到达方位角扩展
- ZSD (Zenith Spread of Departure): 发射天顶角扩展
- ZSA (Zenith Spread of Arrival): 到达天顶角扩展

#### 3.3.3 莱斯因子K

```
K = 10^(μK + σK*X) [dB]
```

### 3.4 多径簇模型

每个簇包含多个子路径（M=20），具有独立的时延和角度：

```
h(t) = Σ Σ α_{n,m} * exp(j*φ_{n,m}) * δ(t - τ_n - τ_{n,m})
       n m
```

其中：
- α_{n,m}：第n簇第m子路径的幅度
- φ_{n,m}：相位
- τ_n：第n簇的时延
- τ_{n,m}：簇内时延偏移

### 3.5 信道生成流程

```
1. 确定场景参数（UMa/UMi/RMa等）
2. 计算路径损耗和阴影衰落
3. 生成大尺度参数（DS, ASD, ASA, K等）
4. 生成簇时延和功率
5. 生成簇角度（AoD, AoA, ZoD, ZoA）
6. 生成子路径参数
7. 应用天线模式和极化
8. 生成时域信道冲激响应
```

## 4. ESPRIT DOA估计算法

### 4.1 算法原理

ESPRIT (Estimation of Signal Parameters via Rotational Invariance Techniques) 利用阵列的旋转不变性进行DOA估计，无需谱峰搜索，计算效率高。

### 4.2 数学模型

对于均匀线阵(ULA)，接收信号模型：

```
X(t) = A(θ)s(t) + n(t)
```

其中：
- X(t)：M×1接收向量
- A(θ)：M×K阵列流形矩阵
- s(t)：K×1信号向量
- n(t)：M×1噪声向量

### 4.3 旋转不变性

将阵列分为两个子阵列：

```
X1 = A1 * s + n1  (前M-1个阵元)
X2 = A2 * s + n2  (后M-1个阵元)
```

存在旋转矩阵Φ：

```
A2 = A1 * Φ
Φ = diag(exp(j*φ1), exp(j*φ2), ..., exp(j*φK))
φk = 2πd*sin(θk)/λ
```

### 4.4 算法步骤

```
1. 构造协方差矩阵:
   R = E[X(t) * X^H(t)]

2. 特征分解:
   R = Us * Σs * Us^H + Un * Σn * Un^H

3. 提取信号子空间:
   Us (M×K维)

4. 分割信号子空间:
   Us1 = Us(1:M-1, :)
   Us2 = Us(2:M, :)

5. 最小二乘估计旋转矩阵:
   Ψ = (Us1^H * Us1)^(-1) * Us1^H * Us2

6. 特征值分解Ψ:
   λk = eigenvalues(Ψ)

7. 计算DOA:
   θk = arcsin(angle(λk) * λ / (2πd))
```

### 4.5 性能指标

| 指标 | 公式 | 说明 |
|------|------|------|
| RMSE | √(E[(θ̂-θ)²]) | 估计均方根误差 |
| 分辨率 | 最小可分辨角度差 | 区分相邻信源能力 |
| 成功概率 | P(‖θ̂-θ‖<ε) | 估计误差小于阈值的概率 |

### 4.6 与MUSIC算法对比

| 特性 | ESPRIT | MUSIC |
|------|--------|-------|
| 计算复杂度 | O(M³) | O(M³ + N_grid) |
| 谱峰搜索 | 不需要 | 需要 |
| 分辨率 | 中等 | 高 |
| 阵列要求 | 需旋转不变结构 | 任意阵列 |
| 低SNR性能 | 较差 | 较好 |

## 5. 算法集成架构

```
┌─────────────────────────────────────────────────────────────┐
│                    ISAC-CRAN 算法层                          │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐   │
│  │  信道建模模块   │  │  波束成形模块   │  │  DOA估计模块   │   │
│  │ (3GPP TR38.901)│  │ (DL+传统混合)  │  │ (ESPRIT+MUSIC)│   │
│  └───────┬───────┘  └───────┬───────┘  └───────┬───────┘   │
│          │                  │                  │            │
│          v                  v                  v            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   算法调度器                          │   │
│  │  - 任务队列管理                                       │   │
│  │  - 资源分配                                           │   │
│  │  - 结果缓存                                           │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## 6. 验证方案

### 6.1 MATLAB验证

提供MATLAB脚本验证Go实现的正确性：

1. **信道模型验证**：对比3GPP信道统计特性
2. **波束成形验证**：对比和速率、波束方向图
3. **DOA估计验证**：对比RMSE、成功率

### 6.2 仿真场景

| 场景 | 参数设置 | 验证指标 |
|------|----------|----------|
| 单用户波束成形 | Nt=64, Nr=1 | 频谱效率 |
| 多用户波束成形 | Nt=64, K=4 | 和速率 |
| DOA估计 | M=16, K=3 | RMSE |
| 信道建模 | UMa, fc=3.5GHz | 时延扩展、角度扩展 |

## 7. 参考文献

1. 3GPP TR 38.901: Study on channel model for frequencies from 0.5 to 100 GHz
2. R. Roy and T. Kailath, "ESPRIT-estimation of signal parameters via rotational invariance techniques," IEEE Trans. ASSP, 1989
3. H. Huang et al., "Deep Learning for Massive MIMO Channel Estimation," IEEE Signal Processing, 2020
